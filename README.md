# Dirs_discarded_monitoring
 
**Скрипт осуществляет поиск по каталогу discarded подкаталогов, архивирует в zip и отправляет количество созданных архивов в чат**

### Шаги:
#### 1. Проходим по каталогу discarded
Возращаем список из папок за период 2 дня, если они соответствуют условиям:
* Если имя подкаталога "Обращение пользователя", помечаем элемент dirtype = 'op'
* Если в подкаталоге есть одно из расширений, помечаем элемент dirtype = 'other'

#### 2. Подключаемся к БД
Таблица discarded состоит из:
* id - нумерованный список
* dir - имя подкаталога
* link - ссылки на все файлы подкаталога
* time - время создания подкаталога
* dirtype - тип подкаталога

#### 3. Удаляем старые строки из БД
Удалять, если они старше недели. Сделано, чтобы не держать лишнюю информацию.

#### 4. Читаем из БД имена каталогов для сравнения
Проходим по всей БД и возвращаем список элементов dir

#### 5. Сверяем несовпадающие имена папок в списках
Берем список из п.4 и сравниваем с элементами списка из п.1, созданный список из несовпадающих элементов вновь сверяем со списком из п.1 сразу же удаляя из последнего совпавшие элементы. Таким образом создав список из элементов, которых нет в БД. Возвращаем список.

#### 6. Создаем архив из подкаталогов
Из созданного списка в п.5 создаем новый список с архивами и путями где лежат архивы. Архивы складируются в папку discarded_temp/

#### 7. Пишем созданные zip архивы в БД
Созданный список в п.6 пишем в БД

#### 8. Отправляем данные в чат MATTERMOST по вебхуку
Из созданного списка в п.6 создаем сообщение с количетсовм созданных архивов и отпавляем данное сообщение в чат.

#### 9. (В ДОРАБОТКЕ) Отправляем данные архивы по SMTP
Из созданного списка в п.6 берем прямые пути до zip архивов и отпарвляем их по "THE BAT" в соответствии с типом подкаталога (dirtype) на разные почтовые адреса.
